// --- DATA (RETAINED FROM PREVIOUS) ---
// (In a real app, I would import these, but keeping single file structure for you)
// I will re-inject the expanded notes here to ensure nothing is lost.

const notes = [
    {
        id: 'ch2', title: 'Ch 2: Company and Marketing Strategy', content: `
        <h3>Theme: Partnering to Build Customer Engagement, Value, and Relationships</h3>
        
        <h3>1. Strategic Planning</h3>
        <p>The process of developing and maintaining a strategic fit between the organizations goals/capabilities and its changing marketing opportunities.</p>
        <div class="tip-box">
            <strong>The 4 Steps of Strategic Planning:</strong>
            <ol>
                <li><strong>Defining the Mission:</strong> What is our purpose?</li>
                <li><strong>Setting Objectives:</strong> Turning the mission into detailed supporting objectives.</li>
                <li><strong>Designing the Business Portfolio:</strong> Deciding which businesses to invest in.</li>
                <li><strong>Planning Marketing Strategies:</strong> Detailed planning for each functional department.</li>
            </ol>
            <p>üí° <strong>Memory Tip:</strong> M-O-P-S (Mission, Objectives, Portfolio, Strategies).</p>
        </div>

        <h3>2. Mission Statement</h3>
        <p>A statement of the organizations purpose‚Äîwhat it wants to accomplish in the larger environment.</p>
        <h4>Product-Oriented vs. Market-Oriented Definitions:</h4>
        <ul>
            <li><strong>Product-Oriented:</strong> "We sell coffee." (Starbucks)</li>
            <li><strong>Market-Oriented:</strong> "We sell 'The Starbucks Experience'‚Äîone that enriches people's lives."</li>
        </ul>
        <p><em>Example:</em> Airbnb isnt just about renting rooms; their mission is "Belong Anywhere."</p>
        <p><em>Example:</em> CVS Health is a "pharmacy innovation company" helping people on their path to better health.</p>

        <h3>3. Business Portfolio Analysis (BCG Matrix)</h3>
        <p>Evaluates a company's Strategic Business Units (SBUs) based on Market Growth Rate and Relative Market Share.</p>
        <ul>
            <li><strong>Stars:</strong> High growth, High share. (Need heavy investment to finance growth).</li>
            <li><strong>Cash Cows:</strong> Low growth, High share. (Established, produce cash to pay bills).</li>
            <li><strong>Question Marks:</strong> High growth, Low share. (Need cash to hold share; hard decision).</li>
            <li><strong>Dogs:</strong> Low growth, Low share. (Generate enough cash to sustain themselves but no promise).</li>
        </ul>

        <h3>4. The Product/Market Expansion Grid (Growth Strategies)</h3>
        <p>How companies grow sales.</p>
        <ul>
            <li><strong>Market Penetration:</strong> Existing products in Existing markets (e.g., selling more to current customers).</li>
            <li><strong>Market Development:</strong> Existing products in New markets (e.g., Starbucks opening in a new country).</li>
            <li><strong>Product Development:</strong> New products in Existing markets (e.g., Starbucks introducing a new seasonal drink).</li>
            <li><strong>Diversification:</strong> New products in New markets (e.g., buying a non-food business).</li>
        </ul>

        <h3>5. Marketing Mix (The 4 Ps)</h3>
        <p>The set of tactical marketing tools the firm blends to produce the response it wants in the target market.</p>
        <ul>
            <li><strong>Product:</strong> The goods/services offered (Variety, Design, Packaging).</li>
            <li><strong>Price:</strong> Amount of money customers pay (List price, Discounts).</li>
            <li><strong>Place:</strong> Company activities that make the product available (Channels, Logistics).</li>
            <li><strong>Promotion:</strong> Activities that communicate value (Advertising, PR).</li>
        </ul>

        <h3>6. SWOT Analysis</h3>
        <ul>
            <li><strong>Strengths (Internal):</strong> Capabilities, resources.</li>
            <li><strong>Weaknesses (Internal):</strong> Limitations.</li>
            <li><strong>Opportunities (External):</strong> Favorable trends.</li>
            <li><strong>Threats (External):</strong> Unfavorable external factors.</li>
        </ul>

        <h3>7. Measuring Marketing ROI (The "Perfecting" Addition)</h3>
        <p><strong>Marketing ROI:</strong> Net return from a marketing investment divided by the costs of the marketing investment.</p>
        <ul>
            <li><strong>Purpose:</strong> Measures the profits generated by investments in marketing activities.</li>
            <li><strong>Measures:</strong> Standard measures (sales, market share) and Customer-centered measures (customer acquisition, retention, lifetime value).</li>
        </ul>
        `
    },
    {
        id: 'ch7', title: 'Ch 7: Customer Value-Driven Marketing Strategy', content: `
        <h3>Theme: Creating Value for Target Customers</h3>

        <h3>1. The Core Strategy Steps (STDP)</h3>
        <ul>
            <li><strong>Segmentation:</strong> Divide the total market into smaller segments.</li>
            <li><strong>Targeting:</strong> Select the segment or segments to enter.</li>
            <li><strong>Differentiation:</strong> Differentiate the market offering to create superior customer value.</li>
            <li><strong>Positioning:</strong> Position the market offering in the minds of target customers.</li>
        </ul>

        <h3>2. Market Segmentation Bases</h3>
        <p>How do we divide the market?</p>
        <ul>
            <li><strong>Geographic:</strong> Nations, regions, states, cities (e.g., Target sells winter coats in NY, swimsuits in FL).</li>
            <li><strong>Demographic:</strong> Age, gender, income, occupation.</li>
            <li><strong>Psychographic:</strong> Social class, lifestyle, personality. <br><em>Example:</em> Rocky Mountain Tiny Houses targets the "simple living" lifestyle segment.</li>
            <li><strong>Behavioral:</strong> Occasions, benefits sought, user status, usage rate. <br><em>Example:</em> Schwinn makes bikes for different benefits‚Äîmountain vs. road.</li>
        </ul>
        <div class="mnemonic-box">üí° <strong>Memory Tip:</strong> G-D-P-B (Good Dogs Play Ball) -> Geo, Demo, Psycho, Behavior.</div>

        <h3>3. Business & International Segmentation (The "Perfecting" Addition)</h3>
        <ul>
            <li><strong>Business Markets:</strong> Segmented by operating characteristics, purchasing approaches, situational factors, and personal characteristics.</li>
            <li><strong>Intermarket (Cross-Market) Segmentation:</strong> Forming segments of consumers who have similar needs/behaviors even though they are located in different countries. <br><em>Example:</em> Zara targets style-conscious but value-seeking consumers globally.</li>
        </ul>

        <h3>4. Requirements for Effective Segmentation</h3>
        <p>To be useful, segments must be:</p>
        <ul>
            <li><strong>Measurable:</strong> Size and purchasing power can be measured.</li>
            <li><strong>Accessible:</strong> Can be reached and served.</li>
            <li><strong>Differentiable:</strong> Respond differently to different marketing elements.</li>
            <li><strong>Substantial:</strong> Large and profitable enough.</li>
            <li><strong>Actionable:</strong> Effective programs can be designed for them.</li>
        </ul>

        <h3>5. Market Targeting Strategies</h3>
        <ul>
            <li><strong>Undifferentiated (Mass) Marketing:</strong> Target the whole market with one offer.</li>
            <li><strong>Differentiated (Segmented) Marketing:</strong> Target several market segments with separate offers. <br><em>Example:</em> Marriott (IHG) has different brands like Holiday Inn vs. Hotel Indigo.</li>
            <li><strong>Concentrated (Niche) Marketing:</strong> Large share of a small market. <br><em>Example:</em> American Giant focusing on made-in-USA apparel.</li>
            <li><strong>Micromarketing:</strong> Tailoring products to specific individuals (Local marketing & Individual marketing). <br><em>Example:</em> FitMyFoot 3D prints footwear for individual feet.</li>
        </ul>

        <h3>6. Differentiation & Positioning</h3>
        <p><strong>Positioning:</strong> The place the product occupies in the consumer's mind relative to competitors.</p>
        <p><em>Example:</em> Land Rover positions itself on luxury + off-road performance.</p>
        <div class="tip-box"><strong>Socially Responsible Targeting:</strong> Marketers must consider if they are targeting vulnerable segments responsibly (e.g., not targeting kids with junk food).</div>
        `
    },
    {
        id: 'ch8', title: 'Ch 8: Products, Services, and Brands', content: `
        <h3>üìö Chapter 8: Products, Services, and Brands</h3>
        <p><strong>Goal: Building Customer Value</strong></p>

        <h3>1. What is a Product?</h3>
        <p><strong>Definition:</strong> A product is anything that can be offered to a market for attention, acquisition, use, or consumption that might satisfy a want or need.</p>
        <p><strong>Broad Definition:</strong> It is not just tangible objects (cars, phones). It includes services, events, persons, places, organizations, and ideas (e.g., an Instagram account or a trip to Las Vegas).</p>
        <p><strong>Service:</strong> A form of product that consists of activities, benefits, or satisfactions offered for sale that are essentially intangible and do not result in the ownership of anything (e.g., banking, hotel stays).</p>

        <h4>Levels of Product and Services</h4>
        <p>Marketers plan products on three levels.</p>
        <ol>
            <li><strong>Core Customer Value:</strong> The most basic level. It answers the question, "What is the buyer really buying?" (e.g., An iPad buyer is buying "entertainment, self-expression, and connectivity," not just a tablet).</li>
            <li><strong>Actual Product:</strong> The physical device with features, design, quality level, brand name, and packaging.</li>
            <li><strong>Augmented Product:</strong> Additional services and benefits built around the core and actual product (e.g., warranty, delivery, credit, after-sale service).</li>
        </ol>
        <div class="tip-box">
            <strong>üí° Exam Tip:</strong> If asked to analyze a product like a smartphone:
            <ul>
                <li><strong>Core:</strong> Communication/Connection.</li>
                <li><strong>Actual:</strong> The phone itself, the screen, the Apple logo.</li>
                <li><strong>Augmented:</strong> AppleCare+, iCloud storage service.</li>
            </ul>
        </div>

        <h3>2. Product Classifications</h3>
        <p>Products are divided into two broad classes based on the types of consumers who use them: Consumer Products and Industrial Products.</p>

        <h4>A. Consumer Products</h4>
        <p>Products bought by final consumers for personal consumption.</p>
        <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
            <tr style="background:var(--bg-card);">
                <th style="padding:0.75rem; border:1px solid var(--border-subtle); text-align:left;">Type</th>
                <th style="padding:0.75rem; border:1px solid var(--border-subtle); text-align:left;">Definition</th>
                <th style="padding:0.75rem; border:1px solid var(--border-subtle); text-align:left;">Buying Behavior</th>
                <th style="padding:0.75rem; border:1px solid var(--border-subtle); text-align:left;">Examples</th>
            </tr>
            <tr>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Convenience</strong></td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Bought frequently, immediately, with minimal comparison/effort.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Low price, widespread distribution.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Soap, candy, newspapers, fast food.</td>
            </tr>
            <tr>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Shopping</strong></td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Bought less frequently; customers compare on suitability, quality, price, and style.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Higher price, selective distribution.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Furniture, clothing, major appliances, hotels.</td>
            </tr>
            <tr>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Specialty</strong></td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Unique characteristics or brand identification; buyers make a special purchase effort.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">High price, exclusive distribution.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Lamborghini, Rolex, medical specialist services.</td>
            </tr>
            <tr>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Unsought</strong></td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Consumer either does not know about or knows about but does not normally consider buying.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Requires aggressive advertising/selling.</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);">Life insurance, blood donations, funeral services.</td>
            </tr>
        </table>

        <h4>B. Industrial Products</h4>
        <p>Products bought by individuals and organizations for further processing or for use in conducting a business.</p>
        <ul>
            <li><strong>Materials and Parts:</strong> Raw materials (wheat, timber) and manufactured parts (tires, small motors).</li>
            <li><strong>Capital Items:</strong> Aid in the buyer's production or operations, including installations (factories) and accessory equipment (lift trucks, computers).</li>
            <li><strong>Supplies and Services:</strong> Operating supplies (lubricants, paper) and repair/maintenance services (window cleaning).</li>
        </ul>
        <div class="mnemonic-box">üí° <strong>Trick to Remember:</strong> The difference between a consumer and industrial product is the purpose of the purchase. If you buy a lawnmower for your home, it's a Consumer Product. If a landscaping business buys the same lawnmower to cut clients' grass, it's an Industrial Product.</div>

        <h3>3. Product and Service Decisions</h3>
        <p>Marketers make decisions at three levels: Individual Product, Product Line, and Product Mix.</p>

        <h4>Level 1: Individual Product Decisions</h4>
        <ul>
            <li><strong>Product Attributes:</strong>
                <ul>
                    <li><strong>Quality:</strong> Performance quality (ability to perform functions) and Conformance quality (consistency).</li>
                    <li><strong>Features:</strong> A competitive tool for differentiating the product.</li>
                    <li><strong>Style & Design:</strong> Style is appearance; Design contributes to usefulness and looks.</li>
                </ul>
            </li>
            <li><strong>Branding:</strong> A name, term, sign, symbol, or design that identifies the maker or seller.</li>
            <li><strong>Packaging:</strong> Designing and producing the container or wrapper. (Functions: protect, attract, describe, and sell).</li>
            <li><strong>Labeling:</strong> Identifies the product, describes it, and promotes the brand (regulated by laws like the Fair Packaging and Labeling Act).</li>
            <li><strong>Product Support Services:</strong> Customer service acts as a differentiator (e.g., Apple's Genius Bar).</li>
        </ul>

        <h4>Level 2: Product Line Decisions</h4>
        <p><strong>Product Line:</strong> A group of products that are closely related because they function in a similar manner, are sold to the same customer groups, are marketed through the same types of outlets, or fall within given price ranges (e.g., Nike produces several lines of athletic shoes).</p>
        <ul>
            <li><strong>Line Filling:</strong> Adding more items within the present range of the line (to keep out competitors or use excess capacity).</li>
            <li><strong>Line Stretching:</strong> Lengthening the product line beyond its current range.
                <ul>
                    <li><strong>Downward:</strong> Adding lower-end products (e.g., Mercedes releasing a cheaper A-Class).</li>
                    <li><strong>Upward:</strong> Adding higher-end products to add prestige.</li>
                </ul>
            </li>
        </ul>

        <h4>Level 3: Product Mix (Portfolio) Decisions</h4>
        <p><strong>Product Mix:</strong> The set of all product lines and items that a particular seller offers for sale.</p>
        <ul>
            <li><strong>Width:</strong> Number of different product lines (e.g., Colgate has Oral Care, Personal Care, Home Care, Pet Nutrition).</li>
            <li><strong>Length:</strong> Total number of items a company carries within its product lines.</li>
            <li><strong>Depth:</strong> Number of versions offered for each product in the line (e.g., Colgate toothpaste comes in Total, Optic White, Sensitive, etc.).</li>
            <li><strong>Consistency:</strong> How closely related the various product lines are in end use, production requirements, or distribution channels.</li>
        </ul>

        <h3>4. Services Marketing</h3>
        <p>Services are growing faster than products. They have four special characteristics that affect their marketing.</p>

        <h4>The 4 Characteristics of Services (The 4 Is)</h4>
        <ul>
            <li><strong>Intangibility:</strong> Services cannot be seen, tasted, felt, heard, or smelled before purchase (e.g., airline passengers have nothing but a ticket and a promise).</li>
            <li><strong>Inseparability:</strong> Services cannot be separated from their providers. If a service employee provides the service, then the employee is part of the service.</li>
            <li><strong>Variability:</strong> Quality of services depends on who provides them and when, where, and how (e.g., one Marriott hotel might be better than another).</li>
            <li><strong>Perishability:</strong> Services cannot be stored for later sale or use (e.g., an empty airline seat usually represents lost revenue forever).</li>
        </ul>

        <h4>The Service Profit Chain</h4>
        <p>Service firms must focus on both customers and employees.</p>
        <ul>
            <li><strong>Internal Marketing:</strong> The service firm must orient and motivate its customer-contact employees and supporting service people to work as a team to provide customer satisfaction. (Must happen before external marketing).</li>
            <li><strong>Interactive Marketing:</strong> Service quality depends heavily on the quality of the buyer-seller interaction during the service encounter.</li>
        </ul>

        <h3>5. Branding Strategy: Building Strong Brands</h3>
        <p><strong>Brand Equity:</strong> The differential effect that knowing the brand name has on a customer's response to the product or its marketing. High brand equity provides a competitive advantage.</p>

        <h4>Major Brand Strategy Decisions</h4>

        <p><strong>1. Brand Positioning</strong></p>
        <p>Marketers can position brands at three levels:</p>
        <ul>
            <li><strong>Attributes:</strong> Lowest level (e.g., "fastest," "cheapest"). Least desirable because competitors can copy easily.</li>
            <li><strong>Benefits:</strong> (e.g., "save time," "peace of mind").</li>
            <li><strong>Beliefs and Values:</strong> Highest level; engages customers on a deep, emotional level (e.g., Nike's "Just Do It" passion for sports).</li>
        </ul>

        <p><strong>2. Brand Name Selection</strong></p>
        <p>A good name should suggest benefits, be easy to pronounce/remember, be distinctive, extendable, and capable of registration/legal protection.</p>

        <p><strong>3. Brand Sponsorship</strong></p>
        <ul>
            <li><strong>National Brand (Manufacturer's Brand):</strong> Owned by the manufacturer (e.g., Samsung, Kellogg's).</li>
            <li><strong>Private Brand (Store Brand):</strong> Created and owned by a reseller (e.g., Walmart's Great Value). Trend: Private brands are growing faster than national brands.</li>
            <li><strong>Licensing:</strong> Using names or symbols created by other manufacturers or well-known characters (e.g., Minions on a toothbrush) for a fee.</li>
            <li><strong>Co-branding:</strong> Two established brand names of different companies are used on the same product (e.g., Taco Bell and Doritos for the Doritos Locos Tacos).</li>
        </ul>

        <p><strong>4. Brand Development Strategies</strong></p>
        <p>A powerful matrix for growth.</p>
        <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
            <tr style="background:var(--bg-card);">
                <th style="padding:0.75rem; border:1px solid var(--border-subtle);"></th>
                <th style="padding:0.75rem; border:1px solid var(--border-subtle);">Existing Product Category</th>
                <th style="padding:0.75rem; border:1px solid var(--border-subtle);">New Product Category</th>
            </tr>
            <tr>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Existing Brand Name</strong></td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Line Extension:</strong> Extending an existing brand name to new forms, colors, sizes, ingredients, or flavors of an existing product category (e.g., Coke Zero, Cherry Coke).</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Brand Extension:</strong> Extending an existing brand name to new product categories (e.g., Dyson making lamps, or Mr. Clean car washes).</td>
            </tr>
            <tr>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>New Brand Name</strong></td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>Multibrands:</strong> Marketing many different brands in a given product category (e.g., PepsiCo marketing Pepsi, Mountain Dew, and Sierra Mist).</td>
                <td style="padding:0.75rem; border:1px solid var(--border-subtle);"><strong>New Brands:</strong> Creating a new brand name when entering a new product category where the current brand name is not appropriate (e.g., Toyota creating Lexus for luxury cars).</td>
            </tr>
        </table>

        <div class="tip-box">
            <strong>üí° Exam Trick:</strong>
            <ul>
                <li><strong>Line Extension</strong> = Same name, Same category (New Flavor).</li>
                <li><strong>Brand Extension</strong> = Same name, New category (New type of product).</li>
                <li><strong>Multibrand</strong> = New name, Same category (Competes with itself).</li>
                <li><strong>New Brand</strong> = New name, New category.</li>
            </ul>
        </div>
        `
    },
    {
        id: 'ch9', title: 'Ch 9: New Products & Product Life Cycle', content: `
        <h3>1. The Golden Rule of this Chapter</h3>
        <p><strong>Innovation is Survival.</strong></p>
        <p><strong>Fact:</strong> 60%‚Äì80% of new products fail.</p>
        <p><strong>The Solution:</strong> You need a system to innovate.</p>
        <p><em>Example:</em> Google (Alphabet) isn't just a search engine; it's a "Moonshot Factory" culture that accepts failure to find the next big thing.</p>

        <h3>2. The 8 Steps to Creating a New Product</h3>
        <div class="tip-box">
            <strong>Must memorize this order:</strong>
            <ol>
                <li><strong>Idea Generation:</strong> Finding ideas (Internal R&D, Crowdsourcing).</li>
                <li><strong>Idea Screening:</strong> R-W-W Rule (Real? Win? Worth?).</li>
                <li><strong>Concept Development & Testing:</strong> Detailed version tested with consumers ("Would you buy this?").</li>
                <li><strong>Marketing Strategy:</strong> Target market, price, budget.</li>
                <li><strong>Business Analysis:</strong> Check the money (Sales vs Costs).</li>
                <li><strong>Product Development:</strong> Building the physical prototype (Big money spent here, e.g., Pfizer COVID vaccine).</li>
                <li><strong>Test Marketing:</strong> Standard (Real cities) vs Simulated (Online).</li>
                <li><strong>Commercialization:</strong> Full launch (When and Where).</li>
            </ol>
            <p>üß† <strong>Mnemonic:</strong> I Saw Cats Marching Behind People Tasting Candy.</p>
        </div>

        <h3>3. The Product Life Cycle (PLC)</h3>
        <ul>
            <li><strong>Stage 1: Introduction (The Baby):</strong> Low sales, negative profits. Goal: Awareness.</li>
            <li><strong>Stage 2: Growth (The Teenager):</strong> Climbing sales, rising profits. Goal: Maximize Market Share.</li>
            <li><strong>Stage 3: Maturity (The Adult):</strong> Peak sales, leveling profits. Goal: Defend profit (Modify product/marketing).</li>
            <li><strong>Stage 4: Decline (The Senior):</strong> Falling sales. Strategy: Milk (cut costs) or Drop.</li>
        </ul>

        <h3>4. Vital Terms</h3>
        <ul>
            <li><strong>Crowdsourcing:</strong> Asking the "crowd" for ideas.</li>
            <li><strong>Standardization:</strong> Exact same product globally (iPhone).</li>
            <li><strong>Adaptation:</strong> Modifying for local culture (McDonald's wine in France).</li>
        </ul>
        <div class="tip-box">
            <strong>Exam Tips:</strong><br>
            - If they ask about "Screening": Write <strong>R-W-W</strong>.<br>
            - Introduction Stage Goal = <strong>AWARENESS</strong>.<br>
            - Maturity Stage Goal = <strong>DEFENSE</strong>.
        </div>
        `
    },
    {
        id: 'ch10', title: 'Ch 10: Pricing ‚Äì Understanding Value', content: `
        <h3>1. The Golden Rule of this Chapter</h3>
        <p><strong>Price is the only "P" that brings in money.</strong> (Others are costs).</p>
        <p>You don't just set a number; you capture value.</p>
        <p><em>Example:</em> Peloton charges $1,745 for the "cult" and lifestyle, not just the bike.</p>

        <h3>2. The 3 Major Pricing Strategies</h3>
        <h4>Strategy 1: Customer Value-Based Pricing (The "Right" Way)</h4>
        <p>Start with the customer's perception of value.</p>
        <ul>
            <li><strong>Good-Value Pricing:</strong> Fair quality at fair price (Aldi).</li>
            <li><strong>Value-Added Pricing:</strong> Charging more for features/services (Peloton).</li>
        </ul>

        <h4>Strategy 2: Cost-Based Pricing (The "Math" Way)</h4>
        <p>Cost + Markup. Risk: Ignores demand.</p>
        <ul>
            <li><strong>Cost-Plus:</strong> Cost + Markup.</li>
            <li><strong>Break-Even:</strong> Price covers costs exactly (0 profit).</li>
        </ul>

        <h4>Strategy 3: Competition-Based Pricing (The "Follower" Way)</h4>
        <p>Look at competitors. More value? Higher price. Less value? Lower price.</p>

        <h3>3. Essential Cost Terms</h3>
        <ul>
            <li><strong>Fixed Costs (Overhead):</strong> Stay same (Rent, Salaries). Memory: "The Factory".</li>
            <li><strong>Variable Costs:</strong> Go up with volume (Materials). Memory: "The Volume".</li>
            <li><strong>Total Costs:</strong> Fixed + Variable.</li>
        </ul>

        <h3>4. The Economics Stuff</h3>
        <ul>
            <li><strong>Demand Curve:</strong> Price ‚¨ÜÔ∏è = Demand ‚¨áÔ∏è.</li>
            <li><strong>Price Elasticity:</strong> Sensitivity to price.
                <ul>
                    <li><strong>Inelastic:</strong> "Need it" (Gas).</li>
                    <li><strong>Elastic:</strong> "Too expensive, bye" (Vacation).</li>
                </ul>
            </li>
        </ul>
        <div class="tip-box">
            <strong>Exam Tips:</strong><br>
            - "Perception" = <strong>Value-Based</strong>.<br>
            - "Markup" = <strong>Cost-Based</strong>.
        </div>
        `
    },
    {
        id: 'ch11', title: 'Ch 11: Pricing Strategies (Advanced)', content: `
        <h3>1. Pricing New Products</h3>
        <ul>
            <li><strong>Market-Skimming:</strong> High initial price to "skim" revenue (Apple). Use when high quality/image.</li>
            <li><strong>Market-Penetration:</strong> Low initial price to win share (Samsung/IKEA). Use when market is price-sensitive.</li>
        </ul>

        <h3>2. Product Mix Pricing</h3>
        <ul>
            <li><strong>Product Line:</strong> Price steps (iPhone 14 vs Pro).</li>
            <li><strong>Optional-Product:</strong> Main + Extras (Car + GPS).</li>
            <li><strong>Captive-Product:</strong> Cheap main + Expensive supplies (Printer + Ink). Memory: "Trapped".</li>
            <li><strong>By-Product:</strong> Selling waste (Sawdust).</li>
            <li><strong>Product Bundle:</strong> Combo pack (McDonald's Meal).</li>
        </ul>

        <h3>3. Price Adjustment Strategies</h3>
        <ul>
            <li><strong>Discount/Allowance:</strong> Cash discount, Trade-in.</li>
            <li><strong>Segmented:</strong> Student/Senior discounts.</li>
            <li><strong>Psychological:</strong> $100 perfume smells better than $10. Reference prices ("Was $100!").</li>
            <li><strong>Promotional:</strong> Flash sales.</li>
            <li><strong>Dynamic:</strong> Prices move with demand (Uber). Memory: "Movement".</li>
        </ul>

        <h3>4. Public Policy (The Illegal Stuff)</h3>
        <ul>
            <li><strong>Price Fixing:</strong> Collusion with competitors.</li>
            <li><strong>Predatory Pricing:</strong> Selling below cost to kill competition.</li>
            <li><strong>Deceptive Pricing:</strong> Lying about original price.</li>
        </ul>
        `
    },
    {
        id: 'ch12', title: 'Ch 12: Marketing Channels ‚Äì Delivering Value', content: `
        <h3>Theme: You can cut out the middleman, but you can't cut out their job.</h3>
        <p><strong>Value Delivery Network:</strong> It's a partnership. (Supplier -> Company -> Distributor -> Customer).</p>
        <p><em>Example:</em> Airbnb disrupted this by creating a new network.</p>

        <h3>2. How Channels Are Organized</h3>
        <ul>
            <li><strong>Conventional:</strong> Everyone fights; lower profits.</li>
            <li><strong>Vertical Marketing System (VMS):</strong> Teamwork.
                <ul>
                    <li><strong>Corporate:</strong> Single ownership (Zara).</li>
                    <li><strong>Contractual:</strong> Franchise (McDonald's).</li>
                    <li><strong>Administered:</strong> Big player bullies (Walmart).</li>
                </ul>
            </li>
            <li><strong>Horizontal:</strong> Two companies join (Starbucks inside Target).</li>
        </ul>

        <h3>3. Distribution Strategies</h3>
        <ul>
            <li><strong>Intensive:</strong> Everywhere (Coke).</li>
            <li><strong>Exclusive:</strong> Few places (Rolex).</li>
            <li><strong>Selective:</strong> Middle (TVs).</li>
        </ul>

        <h3>4. Logistics (The Moving Stuff)</h3>
        <p>Goal: Right product, right place, right time, right cost.</p>
        <ul>
            <li><strong>Warehousing:</strong> Storing.</li>
            <li><strong>Inventory (JIT):</strong> Just-in-Time saves storage cost.</li>
            <li><strong>Transportation:</strong> Truck (Flexible), Rail (Bulk), Water (Cheap/Slow), Air (Fast/Exp), Multimodal.</li>
        </ul>
        <div class="tip-box">
            <strong>Exam Tips:</strong><br>
            - <strong>Disintermediation:</strong> Killing the middleman (Spotify killed CD stores).<br>
            - <strong>Upstream:</strong> Raw materials. <strong>Downstream:</strong> Retailers (Marketing focus).
        </div>
        `
    }
];


const islamicNotes = [
    {
        id: 'isl1', title: 'Topic 1: General Computing Concepts', content: `
        <h3>1. Information Processing Cycle (IPOS)</h3>
        <p>All computers follow a standard cycle to convert raw data into useful information.</p>
        <ul>
            <li><strong>Input:</strong> Entering raw data (e.g., typing on a keyboard, clicking a mouse).</li>
            <li><strong>Process:</strong> The CPU converts that raw data into information based on instructions.</li>
            <li><strong>Output:</strong> Displaying the result (e.g., monitor, printer, speaker).</li>
            <li><strong>Storage:</strong> Saving data for later use (e.g., Hard Drive, Cloud, USB).</li>
        </ul>
        <div class="mnemonic-box">üí° <strong>Tip (Mnemonic):</strong> Remember "IPOS" ‚Äî Input, Processing, Output, Storage.</div>
        
        <div class="tip-box">
            <strong>Pizza Shop Analogy:</strong>
            <ul>
                <li><strong>Input:</strong> Taking the order (Raw data)</li>
                <li><strong>Process:</strong> Cooking the pizza (Processing)</li>
                <li><strong>Output:</strong> Serving the pizza to the customer (Information)</li>
                <li><strong>Storage:</strong> Freezing leftovers for later (Saving)</li>
            </ul>
        </div>

        <h3>2. Data Conversion & ASCII Code</h3>
        <p>Computers only understand Binary (0s and 1s). To bridge the gap between human language and computer machine language, we use encoding systems like ASCII.</p>
        
        <p><strong>What is ASCII?</strong></p>
        <ul>
            <li><strong>Acronym:</strong> American Standard Code for Information Interchange.</li>
            <li><strong>Function:</strong> It assigns a unique numeric value to every character (letters, numbers, symbols) so the computer can store it as binary.</li>
            <li><strong>Structure:</strong>
                <ul>
                    <li>Standard ASCII uses 7 bits (representing 128 characters, 0‚Äì127).</li>
                    <li>Extended ASCII uses 8 bits (representing 256 characters, 0‚Äì255) to include more symbols.</li>
                </ul>
            </li>
        </ul>

        <p><strong>Key ASCII Values to Remember:</strong></p>
        <ul>
            <li><strong>"A" (Uppercase):</strong> starts at 65.</li>
            <li><strong>"a" (Lowercase):</strong> starts at 97.</li>
            <li><strong>"0" (Number):</strong> starts at 48.</li>
            <li><strong>Space:</strong> is 32.</li>
        </ul>

        <div class="mnemonic-box">
            ‚ö° <strong>Trick for Conversion:</strong> Uppercase to Lowercase: Add 32.<br>
            Example: 'A' is 65. 65 + 32 = 97, which is 'a'.<br>
            <em>Why 32? In binary, 32 is a single bit flip (2<sup>5</sup>). This makes it very easy for the CPU to switch cases just by flipping one bit!</em>
        </div>

        <h3>3. The Core Hardware: CPU vs. RAM</h3>
        <p>These two work together to run every task on your computer.</p>

        <h4>CPU (Central Processing Unit)</h4>
        <ul>
            <li><strong>Role:</strong> The "Brain" of the computer. It fetches instructions, decodes them, and executes them (The Fetch-Decode-Execute Cycle).</li>
            <li><strong>Speed:</strong> Measured in GHz (Billions of cycles per second).</li>
            <li><strong>Components:</strong>
                <ul>
                    <li><strong>ALU (Arithmetic Logic Unit):</strong> Does the math (+ - √ó √∑) and logic (True/False).</li>
                    <li><strong>Control Unit:</strong> Manages the flow of data and instructions.</li>
                </ul>
            </li>
        </ul>

        <h4>RAM (Random Access Memory)</h4>
        <ul>
            <li><strong>Role:</strong> The "Workspace" or "Short-term Memory". It holds data currently in use for quick access by the CPU.</li>
            <li><strong>Volatile:</strong> If you turn the power off, everything in RAM is deleted.</li>
        </ul>

        <div class="tip-box">
            <strong>The Kitchen Analogy:</strong>
            <ul>
                <li><strong>CPU (The Chef):</strong> Processes the ingredients (data). A faster chef chops faster.</li>
                <li><strong>RAM (The Countertop):</strong> Where ingredients are placed for immediate cooking. Low RAM = Small counter = Chef wastes time walking to pantry.</li>
                <li><strong>Hard Drive (The Pantry):</strong> Where ingredients are stored long-term. Huge capacity, but slower to access.</li>
            </ul>
        </div>

        <h3>4. Client-Server Architecture</h3>
        <p>This is how modern networks (like the Internet) are organized.</p>
        <ul>
            <li><strong>The Client (Requester):</strong> The device asking for information (e.g., Chrome, mobile app).</li>
            <li><strong>The Server (Provider):</strong> A powerful computer that stores resources and "serves" them (e.g., Web servers, Email servers, Database servers).</li>
        </ul>

        <p><strong>How they talk (Request-Response Loop):</strong></p>
        <ol>
            <li><strong>Request:</strong> The Client sends a message.</li>
            <li><strong>Process:</strong> The Server finds the file or runs the query.</li>
            <li><strong>Response:</strong> The Server sends the data back to the Client to be displayed.</li>
        </ol>

        <div class="mnemonic-box">
            üí° <strong>Tip:</strong> Think of a Restaurant.<br>
            <strong>Client</strong> = Hungry Customer (You).<br>
            <strong>Server</strong> = The Waiter/Kitchen (Fulfills your request).<br>
            <strong>Request</strong> = Your Order.<br>
            <strong>Response</strong> = The Food.
        </div>

        <h3>Summary Checklist for Finals</h3>
        <ul class="checklist">
            <li>[ ] <strong>IPOS:</strong> Can you name the 4 stages? (Input, Process, Output, Storage)</li>
            <li>[ ] <strong>ASCII:</strong> Do you know that 'A'=65 and 'a'=97?</li>
            <li>[ ] <strong>CPU vs RAM:</strong> Remember "Chef vs Countertop."</li>
            <li>[ ] <strong>Client-Server:</strong> Remember "Customer vs Waiter."</li>
        </ul>
        `
    }
    // ... (I'll include the rest of the islamicNotes data but truncating here for brevity)
];

const flashcardsData = [
    { ch: "ch2", f: "Market Segmentation", b: "Dividing a market into smaller segments with distinct needs." },
    { ch: "ch2", f: "Differentiation", b: "Making a product different to create superior customer value." },
    { ch: "ch2", f: "Positioning", b: "Arranging for a product to occupy a clear, distinctive place in consumer minds." },
    { ch: "ch2", f: "Demographic Segmentation", b: "Dividing market by Age, Gender, Income, Occupation." },
    { ch: "ch2", f: "Psychographic Segmentation", b: "Dividing market by Social Class, Lifestyle, Personality." },
    { ch: "ch7", f: "Undifferentiated Marketing", b: "Targeting the whole market with one offer (Mass Marketing)." },
    { ch: "ch7", f: "Micromarketing", b: "Tailoring products to the needs of specific individuals (Local/Individual)." },
    { ch: "ch7", f: "Value Proposition", b: "The full mix of benefits on which a brand is differentiated and positioned." },
    { ch: "ch8", f: "Core Customer Value", b: "The basic problem-solving benefit that consumers are really buying." },
    { ch: "ch8", f: "Augmented Product", b: "Additional consumer services and benefits (Warranty, Credit)." },
    { ch: "ch8", f: "Convenience Product", b: "Consumer product that customers usually buy frequently, immediately, and with minimal comparison." },
    { ch: "ch8", f: "Specialty Product", b: "Consumer product with unique characteristics for which a significant group is willing to make a special purchase effort." },
    { ch: "ch8", f: "Unsought Product", b: "Consumer product that the consumer either does not know about or knows about but does not normally consider buying." },
    { ch: "ch9", f: "Product Life Cycle (PLC)", b: "The course of a product's sales and profits over its lifetime." },
    { ch: "ch9", f: "PLC: Introduction Stage", b: "Period of slow sales growth as product is introduced. Nonexistent profits." },
    { ch: "ch9", f: "PLC: Maturity Stage", b: "Period of slowdown in sales growth because product has achieved acceptance. Profits level off." },
    { ch: "ch10", f: "Value-Based Pricing", b: "Setting price based on buyers' perceptions of value rather than on the seller's cost." },
    { ch: "ch10", f: "Cost-Plus Pricing", b: "Adding a standard markup to the cost of the product." },
    { ch: "ch10", f: "Price Elasticity", b: "A measure of the sensitivity of demand to changes in price." },
    { ch: "ch11", f: "Dynamic Pricing", b: "Adjusting prices continually to meet the characteristics and needs of individual customers and situations." },
    { ch: "ch11", f: "Psychological Pricing", b: "Pricing that considers the psychology of prices, not simply the economics ($9.99)." },
    { ch: "ch12", f: "Direct Marketing Channel", b: "A marketing channel that has no intermediary levels." },
    { ch: "ch12", f: "Vertical Marketing System (VMS)", b: "A channel structure in which producers, wholesalers, and retailers act as a unified system." },
    { ch: "ch12", f: "Multichannel Distribution", b: "A single firm sets up two or more marketing channels to reach one or more customer segments." },
    { ch: "gen", f: "SWOT Analysis", b: "Strengths (Int), Weaknesses (Int), Opportunities (Ext), Threats (Ext)." },
    { ch: "gen", f: "Marketing Mix (4 Ps)", b: "Product, Price, Place, Promotion." }
];

const quizData = [
    // Part 1: Conceptual Questions adapted to Quiz format
    { q: "What is the difference between a Star and a Cash Cow in the BCG Matrix?", a: ["Star: High Growth/High Share, Cash Cow: Low Growth/High Share", "Star: Low Growth/High Share, Cash Cow: High Growth/High Share", "Star: High Growth/Low Share, Cash Cow: Low Growth/Low Share", "They are the same"], c: 0 },
    { q: "What does 'Marketing ROI' measure?", a: ["Return on Influencer investment", "Profits generated by marketing investments", "Rate of Interest on loans", "Revenue from online sales only"], c: 1 },
    { q: "Differentiated Marketing targets:", a: ["The whole market with one offer", "A small niche share", "Multiple segments with separate offers", "One person at a time"], c: 2 },
    { q: "What is a 'Value Proposition'?", a: ["The lowest price on the market", "The full mix of benefits differentiating a brand", "A discount coupon", "The company mission statement"], c: 1 },
    { q: "Service Perishability means:", a: ["Services expire after 1 year", "Services cannot be stored for later sale or use", "Services are always fresh", "Service quality varies by employee"], c: 1 },
    { q: "Line Extension vs. Brand Extension:", a: ["Same category vs. New category", "New category vs. Same category", "Both are new categories", "Both are same category"], c: 0 },
    { q: "In Idea Screening, R-W-W stands for:", a: ["Real, Win, Worth", "Read, Write, Walk", "Ready, Willing, Waiting", "Rich, Wealthy, Wise"], c: 0 },
    { q: "Why are profits often negative in the Introduction stage?", a: ["Low prices", "High development and launch costs", "Too many competitors", "Product is bad"], c: 1 },
    { q: "Good-Value Pricing vs. Value-Added Pricing:", a: ["High price vs. Low price", "Fair quality/price vs. Features justifying higher price", "Math-based vs. Psychology-based", "None of the above"], c: 1 },
    { q: "Price Elasticity measures:", a: ["How fast prices change", "Sensitivity of demand to price changes", "The cost of rubber bands", "Profit margins"], c: 1 },
    { q: "Cheap printer, expensive ink is an example of:", a: ["Product Bundle Pricing", "Captive-Product Pricing", "Optional-Product Pricing", "By-Product Pricing"], c: 1 },
    { q: "Vertical Marketing System (VMS) is:", a: ["Producers, Wholesalers, Retailers acting as a unified system", "Producers fighting Retailers", "Direct to consumer only", "A pyramid scheme"], c: 0 },
    { q: "Disintermediation means:", a: ["Adding more middlemen", "Cutting out marketing channel intermediaries", "Mediating disputes", "Distributing everywhere"], c: 1 },

    // Part 2: MCQs
    { q: "(Chap 2) Growth strategy: make more sales to current customers without changing product?", a: ["Market Development", "Market Penetration", "Product Development", "Diversification"], c: 1 },
    { q: "(Chap 7) Variables like social class, lifestyle, and personality are used in:", a: ["Geographic", "Behavioral", "Psychographic", "Demographic"], c: 2 },
    { q: "(Chap 8) A laundry detergent bought regularly without planning is a:", a: ["Shopping Product", "Specialty Product", "Unsought Product", "Convenience Product"], c: 3 },
    { q: "(Chap 8) 'Service Variability' means:", a: ["Services are invisible", "Services can't be stored", "Quality depends on who/when/where/how", "Produced/consumed same time"], c: 2 },
    { q: "(Chap 9) Stage where competitors enter in large numbers & goal is max market share?", a: ["Introduction", "Growth", "Maturity", "Decline"], c: 1 },
    { q: "(Chap 9) Crowdsourcing is a form of:", a: ["Idea Screening", "Test Marketing", "Idea Generation", "Commercialization"], c: 2 },
    { q: "(Chap 10) Compares costs that change directly with production level:", a: ["Fixed Cost", "Overhead", "Total Cost", "Variable Cost"], c: 3 },
    { q: "(Chap 11) Selling a Razor for $5 but blades for $20 is:", a: ["Product Bundle", "Captive-Product", "Optional-Product", "By-Product"], c: 1 },
    { q: "(Chap 11) Adjusting prices continually (like Uber) is:", a: ["Segmented Pricing", "Dynamic Pricing", "Psychological Pricing", "Promotional Pricing"], c: 1 },
    { q: "(Chap 12) Luxury brands like Rolex use which distribution?", a: ["Intensive", "Selective", "Exclusive", "Mass"], c: 2 }
];

// --- STATE ---
let cards = [...flashcardsData];
let cIdx = 0;
let qIdx = 0;
let qScore = 0;
let timerTime = 25 * 60;
let timerInterval = null;
let isRunning = false;
let soundEnabled = true;

// --- INIT ---
window.onload = () => {
    renderNotes();
    renderIslamicNotes();
    updateCard();
    loadQuiz();
    updateExamCountdown(); // Calc countdowns

    // Focus Name Input auto
    setTimeout(() => document.getElementById('name-input').focus(), 1500);

    // Enter key listener
    document.getElementById('name-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') enterApp();
    });
};

// --- GOD TIER STORM ENGINE ---
class StormSystem {
    constructor() {
        this.canvas = document.getElementById('storm-canvas');
        this.ctx = this.canvas.getContext('2d');
        this.particles = [];
        this.lightning = 0;
        this.width = 0;
        this.height = 0;
        this.resize();
        window.addEventListener('resize', () => this.resize());
    }

    resize() {
        this.width = this.canvas.width = window.innerWidth;
        this.height = this.canvas.height = window.innerHeight;
    }

    start() {
        this.loop();
        // Create Initial Rain
        for(let i=0; i<500; i++) this.particles.push(this.newDrop());
    }

    newDrop() {
        return {
            x: Math.random() * this.width,
            y: Math.random() * this.height,
            l: Math.random() * 20 + 10, // length
            v: Math.random() * 10 + 20  // velocity
        };
    }

    drawLightning() {
        if (Math.random() > 0.02) return; // Rare flash
        
        const x = Math.random() * this.width;
        this.ctx.beginPath();
        this.ctx.moveTo(x, 0);
        let cx = x;
        for (let y = 0; y < this.height; y += 20) {
            cx += (Math.random() - 0.5) * 40;
            this.ctx.lineTo(cx, y);
        }
        this.ctx.strokeStyle = '#fff';
        this.ctx.lineWidth = 2;
        this.ctx.stroke();
        
        // Flash Screen
        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
        this.ctx.fillRect(0,0,this.width, this.height);
        this.lightning = 10;
    }

    loop() {
        // Fade bg for trails
        this.ctx.fillStyle = this.lightning > 0 ? `rgba(69, 10, 10, 0.8)` : 'rgba(10, 0, 0, 0.4)';
        this.ctx.fillRect(0, 0, this.width, this.height);

        if(this.lightning > 0) this.lightning--;

        // Rain
        this.ctx.strokeStyle = 'rgba(220, 38, 38, 0.6)'; // RED RAIN
        this.ctx.lineWidth = 1;
        this.ctx.beginPath();
        for (let p of this.particles) {
            this.ctx.moveTo(p.x, p.y);
            this.ctx.lineTo(p.x, p.y + p.l);
            
            p.y += p.v;
            if (p.y > this.height) {
                p.y = -p.l;
                p.x = Math.random() * this.width;
            }
        }
        this.ctx.stroke();

        this.drawLightning();
        
        requestAnimationFrame(() => this.loop());
    }
}

let stormEngine = null;

// --- CREATIVE ENTRY LOGIC (STRICT MODE) ---
let loginAttempts = 0;

const ACCESS_KEY = "FYODOR DOSTOYEVSKY"; // You can change this to your desired password
let authStep = 1;

function enterApp() {
    const inputField = document.getElementById('name-input');
    const enteredVal = inputField.value.trim();
    const portal = document.getElementById('entry-portal');
    const title = document.getElementById('kratos-title') || document.querySelector('.entry-question');

    // STEP 1: PASSWORD VERIFICATION
    if (authStep === 1) {
        if (enteredVal !== ACCESS_KEY) {
            loginAttempts++;
            
            // VISUAL PENALTY SYSTEM
            if (loginAttempts === 1) {
                // Strike 1: Warning Shake
                inputField.classList.add('shake-element');
                inputField.style.borderColor = '#f59e0b'; // Warning Orange
                setTimeout(() => inputField.classList.remove('shake-element'), 500);
                inputField.value = "";
                inputField.placeholder = "Incorrect Key. Try again.";
            } else if (loginAttempts >= 2) {
                // Strike 2: GOD OF WAR MODE
                const stormContainer = document.getElementById('kratos-storm');
                
                // Trigger Chaos
                portal.classList.add('kratos-mode');
                if (stormContainer) {
                    stormContainer.style.display = 'block';
                    if(!stormEngine) {
                        stormEngine = new StormSystem();
                        stormEngine.start();
                    }
                }
                
                // Force Text Update
                if(title) {
                    title.innerHTML = "BOY. <br> THAT IS NOT THE KEY.";
                    title.style.color = "#ef4444"; // Explicit Red
                    title.style.textShadow = "0 0 30px #b91c1c";
                    title.style.fontFamily = "'Times New Roman', serif";
                }
                
                // Permanent Shake until fixed
                inputField.classList.add('shake-element');
                setTimeout(() => inputField.classList.remove('shake-element'), 500);
                inputField.value = "";
            }
            return; 
        } else {
            // SUCCESS: Transition to Name Step
            authStep = 2;
            inputField.value = "";
            inputField.type = "text";
            inputField.placeholder = "Type your Name";
            if (title) {
                title.innerHTML = "Who is conquering Marketing today?";
                title.style.color = "";
                title.style.textShadow = "";
                title.style.fontFamily = "";
            }
            portal.classList.remove('kratos-mode');
            inputField.style.borderColor = "";
            return;
        }
    }

    // STEP 2: NAME ENTRY
    if (authStep === 2) {
        if (!enteredVal) {
            inputField.classList.add('shake-element');
            setTimeout(() => inputField.classList.remove('shake-element'), 500);
            inputField.placeholder = "Name Required.";
            return;
        }

        // Final Success Logic
        fetch('/api/visitor', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: enteredVal, key: ACCESS_KEY })
        }).catch(console.error);

        const app = document.getElementById('app');

        // Smooth exit
        portal.style.transition = 'opacity 0.8s, transform 0.8s';
        portal.style.opacity = '0';
        portal.style.transform = 'scale(1.1)'; 

        setTimeout(() => {
            portal.style.display = 'none';
            app.classList.add('visible');
            document.getElementById('user-display').innerText = enteredVal; 
        }, 800);
    }
}

// --- NAV ---
function nav(id, el) {
    document.querySelectorAll('.section-view').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');

    // Handle Desktop & Mobile Nav Highlighting
    if (el) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelectorAll('.mobile-nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }
}

// --- NOTES ---
function renderNotes() {
    document.getElementById('notes-grid').innerHTML = notes.map(n => `
        <div class="card" onclick="openNote('${n.id}')">
            <span class="tag purple">${n.id.toUpperCase()}</span>
            <h3>${n.title}</h3>
            <p>Click to read detailed notes.</p>
        </div>
    `).join('');
}
function openNote(id) {
    const n = notes.find(x => x.id === id);
    document.getElementById('note-body').innerHTML = `<h1>${n.title}</h1>${n.content}`;
    document.getElementById('notes-grid').style.display = 'none';
    document.getElementById('note-detail').style.display = 'block';
}
function closeNote() {
    document.getElementById('note-detail').style.display = 'none';
    document.getElementById('notes-grid').style.display = 'grid';
}

// --- ISLAMIC NOTES ---
function renderIslamicNotes() {
    const grid = document.getElementById('islamic-notes-grid');
    if (grid) {
        grid.innerHTML = islamicNotes.map(n => `
            <div class="card" onclick="openIslamicNote('${n.id}')">
                <span class="tag cyan">${n.id.toUpperCase()}</span>
                <h3>${n.title}</h3>
                <p>Click to read detailed notes.</p>
            </div>
        `).join('');
    }
}
function openIslamicNote(id) {
    const n = islamicNotes.find(x => x.id === id);
    document.getElementById('islamic-note-body').innerHTML = `<h1>${n.title}</h1>${n.content}`;
    document.getElementById('islamic-notes-grid').style.display = 'none';
    document.getElementById('islamic-note-detail').style.display = 'block';
}
function closeIslamicNote() {
    document.getElementById('islamic-note-detail').style.display = 'none';
    document.getElementById('islamic-notes-grid').style.display = 'grid';
}

// --- FLASHCARDS ---
function filterCards() {
    const cat = document.getElementById('fc-filter').value;
    if (cat === 'all') cards = [...flashcardsData];
    else cards = flashcardsData.filter(c => c.ch === cat);
    cIdx = 0; updateCard();
}
function updateCard() {
    if (cards.length === 0) return;
    const c = cards[cIdx];
    document.getElementById('fc-tag').innerText = c.ch.toUpperCase();
    document.getElementById('fc-front').innerText = c.f;
    document.getElementById('fc-back').innerText = c.b;
    document.getElementById('fc-count').innerText = `${cIdx + 1} / ${cards.length}`;
    document.querySelector('.flashcard').classList.remove('flipped');
}
function moveCard(dir) {
    cIdx = (cIdx + dir + cards.length) % cards.length;
    updateCard();
}

// --- QUIZ ---
function loadQuiz() {
    if (qIdx >= quizData.length) {
        document.getElementById('quiz-container').innerHTML = `<h1 style="text-align:center;">üéâ Quiz Complete! <br>Score: ${qScore}/${quizData.length}</h1>`;
        return;
    }
    const q = quizData[qIdx];
    document.getElementById('q-text').innerText = q.q;
    document.getElementById('q-options').innerHTML = q.a.map((opt, i) => `
        <button class="quiz-opt" onclick="checkAnswer(this, ${i})">${opt}</button>
    `).join('');
    document.getElementById('q-next').style.display = 'none';
}
function checkAnswer(btn, i) {
    document.querySelectorAll('.quiz-opt').forEach(b => b.disabled = true);
    const q = quizData[qIdx];
    if (i === q.c) { btn.classList.add('correct'); qScore++; document.getElementById('q-score').innerText = qScore; }
    else { btn.classList.add('wrong'); document.querySelectorAll('.quiz-opt')[q.c].classList.add('correct'); }
    document.getElementById('q-next').style.display = 'block';
}
function nextQ() { qIdx++; loadQuiz(); }

// --- TIMER LOGIC ---
function toggleTimer() {
    if (isRunning) {
        clearInterval(timerInterval);
        document.getElementById('timerBtn').innerText = "Resume Focus";
        document.getElementById('timerBtn').classList.remove('btn-danger'); // Assuming you might have a danger class, otherwise simple text change
    } else {
        timerInterval = setInterval(() => {
            timerTime--;
            updateTimerDisplay();
            if (timerTime <= 0) {
                clearInterval(timerInterval);
                isRunning = false;
                document.getElementById('timerBtn').innerText = "Start Focus";
                if (soundEnabled) document.getElementById('timerSound').play();
                // Optional: Add a visual alarm
                alert("Session Complete!");
            }
        }, 1000);
        document.getElementById('timerBtn').innerText = "Pause";
    }
    isRunning = !isRunning;
}

function resetTimer() {
    clearInterval(timerInterval);
    isRunning = false;
    timerTime = 25 * 60;
    updateTimerDisplay();
    document.getElementById('timerBtn').innerText = "Start Focus";
}

function updateTimerDisplay() {
    const m = Math.floor(timerTime / 60);
    const s = timerTime % 60;
    document.getElementById('timer').innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    document.getElementById('soundBtn').innerText = soundEnabled ? "Sound: On" : "Sound: Off";
    document.getElementById('soundBtn').style.opacity = soundEnabled ? "1" : "0.5";
}

// --- CLOCK LOGIC ---
function updateClock() {
    const now = new Date();
    const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const dateString = now.toLocaleDateString([], { weekday: 'long', month: 'short', day: 'numeric' });

    const clockEl = document.getElementById('live-clock');
    if (clockEl) {
        clockEl.innerHTML = `<div style="text-align:right; line-height:1.2;">
            <div style="font-size:2rem; font-weight:700; color:white;">${timeString}</div>
            <div style="font-size:0.9rem; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1px;">${dateString}</div>
        </div>`;
    }
}
setInterval(updateClock, 1000); // Start clock ticker

// --- EXAM COUNTDOWN ---
function updateExamCountdown() {
    const exams = [
        { date: '2025-12-16', id: 'countdown-0' },
        { date: '2025-12-18', id: 'countdown-1' },
        { date: '2025-12-22', id: 'countdown-2' },
        { date: '2025-12-24', id: 'countdown-3' },
        { date: '2025-12-26', id: 'countdown-4' },
        { date: '2025-12-30', id: 'countdown-5' }
    ];

    const now = new Date();

    exams.forEach(ex => {
        const target = new Date(ex.date);
        const diffTime = target - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        const el = document.getElementById(ex.id);
        if (el) {
            // Update Time Left
            if (diffDays > 0) el.innerText = `${diffDays} Days`;
            else if (diffDays === 0) el.innerText = "Today!";
            else el.innerText = "Done";

            // Update Status Column (Sibling)
            const statusCell = el.nextElementSibling;
            if (statusCell) {
                if (diffDays < 0) {
                    statusCell.innerHTML = `<span style="color:#ef4444; font-weight:bold; opacity:1;">Passed</span>`;
                    el.style.color = "#64748b"; // Dim the 'Done' text
                } else if (diffDays === 0) {
                    statusCell.innerHTML = `<span style="color:#10b981; font-weight:bold; opacity:1;">Active</span>`;
                    el.style.color = "#10b981";
                } else {
                    statusCell.innerHTML = `<span style="opacity:0.3;">Upcoming</span>`;
                }
            }
        }
    });
}

function toggleMobileNav() {
    const sidebar = document.getElementById('mainSidebar');
    const overlay = document.getElementById('sidebarOverlay');

    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
}

// --- AI LAUNCHER LOGIC ---
// --- AI LAUNCHER LOGIC ---

// Add spinner animation style dynamically if not present
const styleSheet = document.createElement("style");
styleSheet.innerText = `
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
`;
document.head.appendChild(styleSheet);

// --- FOA MODULE LOGIC ---
function switchFoaTab(tab, btn) {
    // Hide all tabs
    document.querySelectorAll('.foa-content').forEach(el => el.style.display = 'none');
    // Show target tab
    const target = document.getElementById('foa-tab-' + tab);
    if (target) target.style.display = 'block';

    // Reset buttons
    document.querySelectorAll('.foa-tab-btn').forEach(b => {
        b.classList.remove('btn-primary');
        b.style.opacity = '0.7'; 
    });
    
    // Highlight active button
    btn.classList.add('btn-primary');
    btn.style.opacity = '1';
}

function playVideo(videoId) {
    const player = document.getElementById('main-video-player');
    if (player) {
        player.src = 'https://www.youtube.com/embed/' + videoId + '?autoplay=1';
    }
}

function toggleAnswer(button) {
    // Robustly find the answer div. 
    // It assumes structure: <button>...</button> <div class="answer">...</div>
    // nextElementSibling skips text nodes (newlines)
    const answer = button.nextElementSibling;
    
    if (answer && answer.classList.contains('answer')) {
        const isHidden = !answer.classList.contains('show');
        
        if (isHidden) {
            answer.classList.add('show');
            button.innerHTML = 'Hide Answer';
            button.style.background = 'rgba(255,255,255,0.1)';
            button.style.color = 'var(--text-muted)';
        } else {
            answer.classList.remove('show');
            button.innerHTML = 'Show Answer';
            button.style.background = 'var(--brand-primary)';
            button.style.color = '#000';
        }
    } else {
        console.error("Answer element not found next to button", button);
    }
}